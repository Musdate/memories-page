import{a as x}from"./chunk-POUALIHI.js";import{K as b,M as y,Ob as w,R as g,ea as u,j as k,k as p,o as i,qb as c,rb as S,sb as D,w as a}from"./chunk-WIJM5ZBD.js";import{a as v,b as f}from"./chunk-C6Q5SG76.js";function I(r){return S(f(v({},r),{loader:void 0,stream:e=>{let t,n=()=>t.unsubscribe();e.abortSignal.addEventListener("abort",n);let s=u({value:void 0}),l,U=new Promise(o=>l=o);function h(o){s.set(o),l?.(s),l=void 0}let m=r.stream??r.loader;if(m===void 0)throw new b(990,!1);return t=m(e).subscribe({next:o=>h({value:o}),error:o=>{h({error:D(o)}),e.abortSignal.removeEventListener("abort",n)},complete:()=>{l&&h({error:new b(991,!1)}),e.abortSignal.removeEventListener("abort",n)}}),U}}))}var d=x.baseUrl,M=class r{_authStatus=u("checking");_user=u(null);_token=u(localStorage.getItem("token"));http=g(w);checkStatusResource=I({stream:()=>this.checkStatus()});authStatus=c(()=>this._authStatus()==="checking"?"checking":this._user()?"authenticated":"not-authenticated");user=c(()=>this._user());token=c(()=>this._token());login(e,t){let n=`${d}/auth/login`;return this.http.post(n,{email:e,password:t}).pipe(i(s=>this.handleAuthSuccess(s)),a(s=>this.handleAuthError(s)))}register(e){let t=`${d}/auth/register`;return this.http.post(t,e).pipe(i(n=>this.handleAuthSuccess(n)),a(n=>this.handleAuthError(n)))}update(e){let t=`${d}/auth/update`;return this.http.patch(t,e).pipe(i(n=>(this._user.set(n),n)),a(n=>p(()=>n.error.message)))}checkStatus(){return localStorage.getItem("token")?this.http.get(`${d}/auth/check-status`).pipe(i(t=>this.handleAuthSuccess(t)),a(t=>this.handleAuthError(t))):(this.logout(),k(!1))}logout(){this._user.set(null),this._token.set(null),this._authStatus.set("not-authenticated"),localStorage.removeItem("token")}handleAuthSuccess(e){return this._user.set(e.user),this._token.set(e.token),this._authStatus.set("authenticated"),localStorage.setItem("token",e.token),!0}handleAuthError(e){return this.logout(),p(()=>e)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=y({token:r,factory:r.\u0275fac,providedIn:"root"})};export{M as a};
